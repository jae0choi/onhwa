<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <!-- <meta http-equiv="Content-Security-Policy" content="upgrade-insecure-requests"> -->
    <title>Onhwa cafe</title>
    <script src="{{url_for('.static', filename='js/jquery-3.6.0.js')}}"></script>
    <script src="{{url_for('.static', filename='js/jquery-ui.min.js')}}"></script>
    <script src="{{url_for('.static', filename='js/ytplayer.js')}}"></script>
    <script src="{{url_for('.static', filename='js/onhwa.js')}}"></script>
    <link rel="stylesheet" href="{{url_for('.static', filename='css/style.css')}}">
</head>

<body>
    <nav>
        <img src="{{url_for('.static', filename='./image/logo.png')}}" alt="">
        <h1>온화카페 DJ 부스</h1>
    </nav>
    <div>
        <a href="{{ url_for('dj') }}">Home</a>
        {% if current_user.is_anonymous %}
        <a href="{{ url_for('login') }}">Login</a>
        {% else %}
        <a href="{{ url_for('logout') }}">Logout</a>
        {% endif %}
    </div>
    <div class="main-container">
        <div class="player-container" id="player">
        </div>
        <div class="playlist-container">
            <h2>플레이리스트</h2>
            <div id="controller">
                <button onclick="prevVideo();">
                    <img src="/static/image/glyphicons_170_step_backward.png">이전 곡
                </button>
                <button onclick="nextVideo();">
                    <img src="/static/image/glyphicons_178_step_forward.png">다음 곡
                </button>
            </div>
            <ul class="playlist" id='playlist'>
                <!-- Show current playlist here-->
                <div class="added-song">
                    <p class="title"></p>
                    <img src="" alt="" class="thumbnail">
                    <button class="remove"></button>
                </div>
            </ul>
            <div class="export">유튜브로 플레이리스트 내보내기 (하루 한번만) <img class="icon export" src="./static/image/youtube.svg" onclick='export_playlist()' /></div>
        </div>
    </div>
    <div class="bottom-container">
        <div class="requests-container">
            <label class="switch">
                <input type="checkbox" id="request_open_checkbox"><br>
                <input type="text" id="request_open_textbox">
            </label>
            <ul id="requests">
            </ul>
            <script>
            url_sse="{{ url_for('sse.stream') }}";
            function request_sse(){
                console.log(url_sse);
                var source = new EventSource(url_sse);
                source.addEventListener('new_request', function(event) {
                    var data = JSON.parse(event.data);
                    console.log("The server says " + data.requester + data.artist + data.title);
                    // index = length of requests 
                    // $('#requests').append("<li class='pending-request'><p class='requester'>" + data.requester + "</p><p class='artist'>" + data.artist + "</p><p class='title'>" + data.title + "</p><img class='icon trash' src='static/image/trash.svg' onclick='remove_request(" + index + ")'/></li>");
                    load_requests(); // change to above
                }, false);
                source.addEventListener('error', function(event) {
                    alert("Failed to connect to event stream. Is Redis running?");
                }, false);
            }
            request_sse();
            </script>
        </div>
        <div class="bottom-content">
            <h2>신청곡 추가</h2>
            <div class="search">
                <!-- Search Form -->
                <form id='search_youtube' action="/search_youtube" method="post" novalidate>
                    {{ form.hidden_tag() }}
                    <!-- protection against CSRF attack -->
                    <!-- {{ form.query.label }}<br> -->
                    {{ form.query(size=24, placeholder="노래 검색") }}
                    <button type="submit" id='search_submit'>
                        <img class="icon search" src="./static/image/search.svg">
                    </button>
                    <!-- <input type="submit" value="검색" id='search'>  -->
                </form>
            </div>
            <div class="search-result">
                <div class="result-song" id='search_result'>
                </div>
            </div>
        </div>
    </div>
    <footer></footer>
 
</body>

</html>